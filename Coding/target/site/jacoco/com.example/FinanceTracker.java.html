<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FinanceTracker.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">finance-tracker</a> &gt; <a href="index.source.html" class="el_package">com.example</a> &gt; <span class="el_source">FinanceTracker.java</span></div><h1>FinanceTracker.java</h1><pre class="source lang-java linenums">// Prompt 2: Moved to com.example package
package com.example;

// Prompt 1: Core logic and data model management
import java.time.LocalDate;
import java.time.YearMonth;
import java.util.*;
// Prompt 2: Gson imports for JSON persistence
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import java.io.*;
// Prompt 5: LocalDate TypeAdapter for Gson
import com.google.gson.TypeAdapter;
import com.google.gson.stream.JsonReader;
import com.google.gson.stream.JsonWriter;
import java.io.IOException;

<span class="fc" id="L18">public class FinanceTracker {</span>
    // Prompt 1: Data fields
<span class="fc" id="L20">    private List&lt;Transaction&gt; transactions = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L21">    private List&lt;Category&gt; categories = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L22">    private List&lt;SpendingLimit&gt; spendingLimits = new ArrayList&lt;&gt;();</span>

    // Prompt 1: Core methods
    public void addTransaction(Transaction transaction) {
<span class="fc" id="L26">        transactions.add(transaction);</span>
<span class="fc" id="L27">        updateSpendingLimit(transaction, true);</span>
<span class="fc" id="L28">    }</span>

    public void removeTransaction(Transaction transaction) {
<span class="fc" id="L31">        transactions.remove(transaction);</span>
<span class="fc" id="L32">        updateSpendingLimit(transaction, false);</span>
<span class="fc" id="L33">    }</span>

    public void addCategory(Category category) {
<span class="fc" id="L36">        categories.add(category);</span>
<span class="fc" id="L37">    }</span>

    public void renameCategory(Category category, String newName) {
<span class="fc" id="L40">        category.setName(newName);</span>
<span class="fc" id="L41">    }</span>

    public void deleteCategory(Category category) {
<span class="fc" id="L44">        categories.remove(category);</span>
<span class="fc bfc" id="L45" title="All 2 branches covered.">        for (Transaction t : transactions) {</span>
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">            if (t.getCategory().equals(category)) {</span>
<span class="fc" id="L47">                t.setCategory(null);</span>
            }
<span class="fc" id="L49">        }</span>
<span class="fc" id="L50">        spendingLimits.removeIf(sl -&gt; sl.getCategory().equals(category));</span>
<span class="fc" id="L51">    }</span>

    public void setSpendingLimit(Category category, double limit) {
<span class="pc bpc" id="L54" title="1 of 2 branches missed.">        for (SpendingLimit sl : spendingLimits) {</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">            if (sl.getCategory().equals(category)) {</span>
<span class="nc" id="L56">                sl.setMonthlyLimit(limit);</span>
<span class="nc" id="L57">                return;</span>
            }
<span class="nc" id="L59">        }</span>
<span class="fc" id="L60">        spendingLimits.add(new SpendingLimit(category, limit));</span>
<span class="fc" id="L61">    }</span>

    public FinanceSummary getMonthlySummary(YearMonth month) {
<span class="fc" id="L64">        double totalIncome = 0;</span>
<span class="fc" id="L65">        double totalExpenses = 0;</span>
<span class="fc" id="L66">        Map&lt;Category, Double&gt; categoryBreakdown = new HashMap&lt;&gt;();</span>
<span class="fc bfc" id="L67" title="All 2 branches covered.">        for (Transaction t : transactions) {</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">            if (YearMonth.from(t.getDate()).equals(month)) {</span>
<span class="fc" id="L69">                double amt = t.getAmount();</span>
<span class="fc bfc" id="L70" title="All 2 branches covered.">                if (t.getType() == TransactionType.INCOME) {</span>
<span class="fc" id="L71">                    totalIncome += amt;</span>
                } else {
<span class="fc" id="L73">                    totalExpenses += amt;</span>
                }
<span class="fc" id="L75">                categoryBreakdown.put(t.getCategory(),</span>
<span class="fc" id="L76">                    categoryBreakdown.getOrDefault(t.getCategory(), 0.0) + amt);</span>
            }
<span class="fc" id="L78">        }</span>
<span class="fc" id="L79">        double netBalance = totalIncome - totalExpenses;</span>
<span class="fc" id="L80">        return new FinanceSummary(totalIncome, totalExpenses, netBalance, categoryBreakdown);</span>
    }

    public List&lt;Transaction&gt; filterTransactions(LocalDate start, LocalDate end, Category category) {
<span class="fc" id="L84">        List&lt;Transaction&gt; filtered = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L85" title="All 2 branches covered.">        for (Transaction t : transactions) {</span>
<span class="pc bpc" id="L86" title="1 of 4 branches missed.">            boolean inRange = (t.getDate().isEqual(start) || t.getDate().isAfter(start)) &amp;&amp;</span>
<span class="pc bpc" id="L87" title="1 of 4 branches missed.">                              (t.getDate().isEqual(end) || t.getDate().isBefore(end));</span>
<span class="pc bpc" id="L88" title="1 of 4 branches missed.">            boolean inCategory = (category == null) || t.getCategory().equals(category);</span>
<span class="pc bpc" id="L89" title="1 of 4 branches missed.">            if (inRange &amp;&amp; inCategory) {</span>
<span class="fc" id="L90">                filtered.add(t);</span>
            }
<span class="fc" id="L92">        }</span>
<span class="fc" id="L93">        return filtered;</span>
    }

    public double getCurrentBalance() {
<span class="nc" id="L97">        double income = 0, expense = 0;</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">        for (Transaction t : transactions) {</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">            if (t.getType() == TransactionType.INCOME) income += t.getAmount();</span>
<span class="nc" id="L100">            else expense += t.getAmount();</span>
<span class="nc" id="L101">        }</span>
<span class="nc" id="L102">        return income - expense;</span>
    }

    public void checkSpendingLimits() {
<span class="fc" id="L106">        Map&lt;Category, Double&gt; monthlyExpenses = new HashMap&lt;&gt;();</span>
<span class="fc" id="L107">        YearMonth currentMonth = YearMonth.now();</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">        for (Transaction t : transactions) {</span>
<span class="pc bpc" id="L109" title="2 of 4 branches missed.">            if (t.getType() == TransactionType.EXPENSE &amp;&amp; YearMonth.from(t.getDate()).equals(currentMonth)) {</span>
<span class="fc" id="L110">                Category cat = t.getCategory();</span>
<span class="fc" id="L111">                monthlyExpenses.put(cat, monthlyExpenses.getOrDefault(cat, 0.0) + t.getAmount());</span>
            }
<span class="fc" id="L113">        }</span>
<span class="fc bfc" id="L114" title="All 2 branches covered.">        for (SpendingLimit sl : spendingLimits) {</span>
<span class="fc" id="L115">            double spent = monthlyExpenses.getOrDefault(sl.getCategory(), 0.0);</span>
<span class="fc" id="L116">            sl.setCurrentSpent(spent);</span>
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">            if (sl.getMonthlyLimit() &gt; 0) {</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">                if (spent &gt;= sl.getMonthlyLimit()) {</span>
<span class="fc" id="L119">                    System.out.println(&quot;Warning: Spending limit exceeded for category: &quot; + sl.getCategory().getName());</span>
<span class="pc bpc" id="L120" title="1 of 2 branches missed.">                } else if (spent &gt;= 0.8 * sl.getMonthlyLimit()) {</span>
<span class="fc" id="L121">                    System.out.println(&quot;Warning: 80% of spending limit reached for category: &quot; + sl.getCategory().getName());</span>
                }
            }
<span class="fc" id="L124">        }</span>
<span class="fc" id="L125">    }</span>

    private void updateSpendingLimit(Transaction transaction, boolean add) {
<span class="fc bfc" id="L128" title="All 2 branches covered.">        if (transaction.getType() == TransactionType.EXPENSE) {</span>
<span class="fc bfc" id="L129" title="All 2 branches covered.">            for (SpendingLimit sl : spendingLimits) {</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">                if (sl.getCategory().equals(transaction.getCategory())) {</span>
<span class="fc" id="L131">                    double current = sl.getCurrentSpent();</span>
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">                    if (add) {</span>
<span class="fc" id="L133">                        sl.setCurrentSpent(current + transaction.getAmount());</span>
                    } else {
<span class="nc" id="L135">                        sl.setCurrentSpent(current - transaction.getAmount());</span>
                    }
                }
<span class="fc" id="L138">            }</span>
        }
<span class="fc" id="L140">    }</span>

    public List&lt;Transaction&gt; getTransactions() {
<span class="fc" id="L143">        return transactions;</span>
    }

    public List&lt;Category&gt; getCategories() {
<span class="fc" id="L147">        return categories;</span>
    }

    public List&lt;SpendingLimit&gt; getSpendingLimits() {
<span class="fc" id="L151">        return spendingLimits;</span>
    }

    // Prompt 2: Persistence methods using Gson
    public void saveToFile(String filePath) {
        // Prompt 5: Register LocalDate adapter
<span class="fc" id="L157">        Gson gson = new GsonBuilder()</span>
<span class="fc" id="L158">            .registerTypeAdapter(LocalDate.class, new LocalDateAdapter())</span>
<span class="fc" id="L159">            .setPrettyPrinting().create();</span>
<span class="fc" id="L160">        DataWrapper wrapper = new DataWrapper(transactions, categories, spendingLimits);</span>
<span class="fc" id="L161">        try (Writer writer = new FileWriter(filePath)) {</span>
<span class="fc" id="L162">            gson.toJson(wrapper, writer);</span>
<span class="nc" id="L163">        } catch (IOException e) {</span>
<span class="nc" id="L164">            e.printStackTrace();</span>
<span class="fc" id="L165">        }</span>
<span class="fc" id="L166">    }</span>

    public void loadFromFile(String filePath) {
        // Prompt 5: Register LocalDate adapter
<span class="fc" id="L170">        Gson gson = new GsonBuilder()</span>
<span class="fc" id="L171">            .registerTypeAdapter(LocalDate.class, new LocalDateAdapter())</span>
<span class="fc" id="L172">            .create();</span>
<span class="fc" id="L173">        try (Reader reader = new FileReader(filePath)) {</span>
<span class="fc" id="L174">            DataWrapper wrapper = gson.fromJson(reader, DataWrapper.class);</span>
<span class="pc bpc" id="L175" title="1 of 2 branches missed.">            if (wrapper != null) {</span>
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">                this.transactions = wrapper.transactions != null ? wrapper.transactions : new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L177" title="1 of 2 branches missed.">                this.categories = wrapper.categories != null ? wrapper.categories : new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L178" title="1 of 2 branches missed.">                this.spendingLimits = wrapper.spendingLimits != null ? wrapper.spendingLimits : new ArrayList&lt;&gt;();</span>
            }
<span class="nc" id="L180">        } catch (IOException e) {</span>
<span class="nc" id="L181">            e.printStackTrace();</span>
<span class="fc" id="L182">        }</span>
<span class="fc" id="L183">    }</span>

    // Prompt 2: Helper class for JSON serialization
    private static class DataWrapper {
        List&lt;Transaction&gt; transactions;
        List&lt;Category&gt; categories;
        List&lt;SpendingLimit&gt; spendingLimits;
<span class="fc" id="L190">        DataWrapper(List&lt;Transaction&gt; transactions, List&lt;Category&gt; categories, List&lt;SpendingLimit&gt; spendingLimits) {</span>
<span class="fc" id="L191">            this.transactions = transactions;</span>
<span class="fc" id="L192">            this.categories = categories;</span>
<span class="fc" id="L193">            this.spendingLimits = spendingLimits;</span>
<span class="fc" id="L194">        }</span>
    }

    // Prompt 5: LocalDate TypeAdapter for Gson
    private static class LocalDateAdapter extends TypeAdapter&lt;LocalDate&gt; {
        @Override
        public void write(JsonWriter out, LocalDate value) throws IOException {
<span class="pc bpc" id="L201" title="1 of 2 branches missed.">            out.value(value != null ? value.toString() : null);</span>
<span class="fc" id="L202">        }</span>
        @Override
        public LocalDate read(JsonReader in) throws IOException {
<span class="fc" id="L205">            String s = in.nextString();</span>
<span class="pc bpc" id="L206" title="1 of 2 branches missed.">            return s != null ? LocalDate.parse(s) : null;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>